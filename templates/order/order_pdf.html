<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Order {{ order.order_number }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.4;
            margin: 0;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
        }
        .header h1 {
            margin: 0;
            font-size: 24px;
            color: #333;
        }
        .section {
            margin-bottom: 20px;
        }
        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        .info-grid {
            display: table;
            width: 100%;
            margin-bottom: 15px;
        }
        .info-row {
            display: table-row;
        }
        .info-cell {
            display: table-cell;
            padding: 5px 10px 5px 0;
            vertical-align: top;
            width: 50%;
        }
        .info-label {
            font-weight: bold;
            color: #555;
        }
        .info-value {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: 11px;
        }
        th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        .item-type-header {
            background-color: #e9e9e9;
            font-weight: bold;
            padding: 10px;
            margin-top: 15px;
            margin-bottom: 5px;
        }
        .summary-table {
            width: 50%;
            margin-left: auto;
            margin-top: 20px;
        }
        .summary-table td {
            padding: 5px 10px;
        }
        .total-row {
            font-weight: bold;
            border-top: 2px solid #333;
        }
        .no-items {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>{{ order.order_number }}</h1>
        <p>Order Date: {{ order.order_date }}</p>
    </div>

    <div class="section">
        <div class="section-title">Order Information</div>
        <div class="info-grid">
            <div class="info-row">
                <div class="info-cell">
                    <span class="info-label">Order Number:</span>
                    <span class="info-value">{{ order.order_number }}</span>
                </div>
                <div class="info-cell">
                    <span class="info-label">Order Date:</span>
                    <span class="info-value">{{ order.order_date }}</span>
                </div>
            </div>
            <div class="info-row">
                <div class="info-cell">
                    <span class="info-label">Created At:</span>
                    <span class="info-value">{{ order.created_at }}</span>
                </div>
                <div class="info-cell">
                    <span class="info-label">Updated At:</span>
                    <span class="info-value">{{ order.updated_at }}</span>
                </div>
            </div>
        </div>
    </div>

    <div class="section">
        <div class="section-title">Customer Information</div>
        <div class="info-grid">
            <div class="info-row">
                <div class="info-cell">
                    <span class="info-label">Company:</span>
                    <span class="info-value">{{ order.customer.company_name|title }}</span>
                </div>
                <div class="info-cell">
                    <span class="info-label">Contact:</span>
                    <span class="info-value">{{ order.customer.first_name|capfirst }} {{ order.customer.last_name|capfirst }}</span>
                </div>
            </div>
            {% if order.customer.notes %}
            <div class="info-row">
                <div class="info-cell" style="width: 100%;">
                    <span class="info-label">Customer Notes:</span><br>
                    <span class="info-value">{{ order.customer.notes|capfirst }}</span>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="section">
        <div class="section-title">Billing Address</div>
        <div class="info-value">
            {{ order.billing_address1|title }}
            {% if order.billing_address2 %}
                <br>{{ order.billing_address2|title }}
            {% endif %}
        </div>
    </div>

    {% if order.notes %}
    <div class="section">
        <div class="section-title">Order Notes</div>
        <div class="info-value">{{ order.notes|capfirst }}</div>
    </div>
    {% endif %}

    <div class="section">
        <div class="section-title">Line Items</div>
        
        <!-- Door Items Table -->
        {% if door_items %}
            <div class="item-type-header">Doors</div>
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Wood Type</th>
                        <th>Edge Profile</th>
                        <th>Panel Rise</th>
                        <th>Style</th>
                        <th>Dimensions (W×H)</th>
                        <th>Rails (T×B×L×R×I)</th>
                        <th>Sanding</th>
                        <th>Qty</th>
                        <th>Price/Unit</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in door_items %}
                        <tr>
                            <td>{{ item.get_type_display }}</td>
                            <td>{{ item.wood_stock.name }}</td>
                            <td>{{ item.edge_profile.name }}</td>
                            <td>{{ item.panel_rise.name }}</td>
                            <td>{{ item.style.name }}</td>
                            <td>{{ item.width }} × {{ item.height }}</td>
                            <td>{{ item.rail_top }} × {{ item.rail_bottom }} × {{ item.rail_left }} × {{ item.rail_right }} × {{ item.interior_rail_size }}</td>
                            <td>
                                {% if item.sand_edge %}Edge, {% endif %}
                                {% if item.sand_cross_grain %}Cross Grain{% endif %}
                                {% if not item.sand_edge and not item.sand_cross_grain %}None{% endif %}
                            </td>
                            <td>{{ item.quantity }}</td>
                            <td>${{ item.price_per_unit|floatformat:2 }}</td>
                            <td>${{ item.total_price|floatformat:2 }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}

        <!-- Drawer Items Table -->
        {% if drawer_items %}
            <div class="item-type-header">Drawers</div>
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Wood Type</th>
                        <th>Edge Type</th>
                        <th>Bottom Type</th>
                        <th>Dimensions (W×H×D)</th>
                        <th>Options</th>
                        <th>Qty</th>
                        <th>Price/Unit</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in drawer_items %}
                        <tr>
                            <td>{{ item.get_type_display }}</td>
                            <td>{{ item.wood_stock.name }}</td>
                            <td>{{ item.edge_type.name }}</td>
                            <td>{{ item.bottom.name }}</td>
                            <td>{{ item.width }} × {{ item.height }} × {{ item.depth }}</td>
                            <td>
                                {% if item.undermount %}Undermount, {% endif %}
                                {% if item.finishing %}Finished{% else %}Unfinished{% endif %}
                            </td>
                            <td>{{ item.quantity }}</td>
                            <td>${{ item.price_per_unit|floatformat:2 }}</td>
                            <td>${{ item.total_price|floatformat:2 }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}

        <!-- Generic Items Table -->
        {% if generic_items %}
            <div class="item-type-header">Miscellaneous Items</div>
            <table>
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Name</th>
                        <th>Quantity</th>
                        <th>Price/Unit</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in generic_items %}
                        <tr>
                            <td>{{ item.get_type_display }}</td>
                            <td>{{ item.name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>${{ item.price_per_unit|floatformat:2 }}</td>
                            <td>${{ item.total_price|floatformat:2 }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% endif %}

        {% if not door_items and not drawer_items and not generic_items %}
            <div class="no-items">No line items found for this order.</div>
        {% endif %}
    </div>

    <div class="section">
        <div class="section-title">Order Summary</div>
        <table class="summary-table">
            <tr>
                <td>Items Total:</td>
                <td>${{ order.item_total|floatformat:2 }}</td>
            </tr>
            <tr>
                <td>Discount:</td>
                <td>-${{ order.discount_amount|floatformat:2 }}</td>
            </tr>
            <tr>
                <td>Surcharge:</td>
                <td>${{ order.surcharge_amount|floatformat:2 }}</td>
            </tr>
            <tr>
                <td>Shipping:</td>
                <td>${{ order.shipping_amount|floatformat:2 }}</td>
            </tr>
            <tr>
                <td>Subtotal:</td>
                <td>${{ order.subtotal|floatformat:2 }}</td>
            </tr>
            <tr>
                <td>Tax:</td>
                <td>${{ order.tax_amount|floatformat:2 }}</td>
            </tr>
            <tr class="total-row">
                <td>Grand Total:</td>
                <td>${{ order.total|floatformat:2 }}</td>
            </tr>
        </table>
    </div>
</body>
</html>